<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Runner Game</title>
<style>
body {
  margin: 0;
  background: #222;
  font-family: Arial;
}

#menu, #warning, #game {
  width: 100vw;
  height: 100vh;
  display: none;
  position: relative;
}

#menu {
  display: block;
  background: #e6f3ff;
}

button {
  font-size: 26px;
  padding: 15px 40px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
}

#playBtn {
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  background: #4caf50;
  color: white;
}

#afkBtn {
  position: absolute;
  bottom: 40px;
  left: 20px;
  background: #aaa;
}

#saveBtn {
  position: absolute;
  top: 20px;
  right: 20px;
  background: gold;
}

#money {
  position: absolute;
  top: 20px;
  left: 20px;
  font-size: 22px;
  background: white;
  padding: 10px 20px;
  border-radius: 15px;
}

#warning {
  background: rgba(0,0,0,0.85);
  color: white;
  text-align: center;
  padding-top: 40vh;
}

#game {
  display: none;
  justify-content: center;
  align-items: center;
  background: #ccc;
}

canvas {
  background: #eee;
  border-radius: 20px;
}
</style>
</head>

<body>

<div id="menu">
  <div id="money">üí∞ <span id="coinText">0</span></div>
  <button id="saveBtn">SAVE</button>
  <button id="afkBtn">AFK</button>
  <button id="playBtn">PLAY</button>
</div>

<div id="warning">
  <h2>‚ö†Ô∏è C·∫¢NH B√ÅO</h2>
  <p>Ch∆°i xong nh·ªõ l∆∞u game<br>n·∫øu kh√¥ng s·∫Ω m·∫•t ti·∫øn tr√¨nh</p>
  <button onclick="startGame()">OK</button>
</div>

<div id="game">
  <canvas id="cv" width="1000" height="500"></canvas>
</div>

<script>
const menu = document.getElementById("menu");
const warning = document.getElementById("warning");
const gameDiv = document.getElementById("game");
const canvas = document.getElementById("cv");
const ctx = canvas.getContext("2d");

let coins = Number(localStorage.getItem("coins")) || 0;
document.getElementById("coinText").innerText = coins;

document.getElementById("saveBtn").onclick = () => {
  localStorage.setItem("coins", coins);
  alert("ƒê√£ l∆∞u!");
};

document.getElementById("playBtn").onclick = () => {
  menu.style.display = "none";
  warning.style.display = "block";
};

function startGame() {
  warning.style.display = "none";
  gameDiv.style.display = "flex";
  resetGame();
  loop();
}

/* ===== GAME ===== */
const laneLines = [120, 250, 380];
const lanes = [185, 315, 445]; // GI·ªÆA C√ÅC L√ÄN

let playerLane = 1;
let legAngle = 0;
let obstacles = [];
let speed = 6;
let score = 0;
let running = true;

/* TOUCH (VU·ªêT) */
let touchStartY = 0;
canvas.addEventListener("touchstart", e => {
  touchStartY = e.touches[0].clientY;
});
canvas.addEventListener("touchend", e => {
  let dy = e.changedTouches[0].clientY - touchStartY;
  if (dy < -40 && playerLane > 0) playerLane--;
  if (dy > 40 && playerLane < 2) playerLane++;
});

document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp" && playerLane > 0) playerLane--;
  if (e.key === "ArrowDown" && playerLane < 2) playerLane++;
});

function resetGame() {
  obstacles = [];
  score = 0;
  playerLane = 1;
  running = true;
}

function spawnObstacle() {
  obstacles.push({
    x: canvas.width,
    lane: Math.floor(Math.random() * 3),
    type: Math.floor(Math.random() * 3)
  });
}

function drawPlayer() {
  const x = 180;
  const y = lanes[playerLane];

  ctx.strokeStyle = "#000";

  ctx.beginPath();
  ctx.arc(x, y - 35, 12, 0, Math.PI * 2);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(x, y - 22);
  ctx.lineTo(x, y + 18);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(x - 12, y);
  ctx.lineTo(x + 12, y);
  ctx.stroke();

  legAngle += 0.2;
  ctx.beginPath();
  ctx.moveTo(x, y + 18);
  ctx.lineTo(x - 8, y + 40 + Math.sin(legAngle) * 8);
  ctx.moveTo(x, y + 18);
  ctx.lineTo(x + 8, y + 40 - Math.sin(legAngle) * 8);
  ctx.stroke();
}

function drawObstacle(o) {
  const y = lanes[o.lane];
  if (o.type === 0) {
    ctx.fillStyle = "gray";
    ctx.fillRect(o.x, y - 15, 40, 30);
  }
  if (o.type === 1) {
    ctx.fillStyle = "brown";
    ctx.fillRect(o.x + 10, y - 10, 20, 40);
    ctx.fillStyle = "green";
    ctx.beginPath();
    ctx.arc(o.x + 20, y - 25, 25, 0, Math.PI * 2);
    ctx.fill();
  }
  if (o.type === 2) {
    ctx.fillStyle = "black";
    ctx.fillRect(o.x, y + 25, 50, 8);
  }
}

function hit(o) {
  return o.x < 210 && o.x > 140 && o.lane === playerLane;
}

let frame = 0;
function loop() {
  if (!running) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle = "#aaa";
  laneLines.forEach(y=>{
    ctx.beginPath();
    ctx.moveTo(0,y);
    ctx.lineTo(canvas.width,y);
    ctx.stroke();
  });

  drawPlayer();

  obstacles.forEach(o=>{
    o.x -= speed;
    drawObstacle(o);
    if (hit(o)) {
      running = false;
      coins += Math.floor(score / 10);
      alert("Game Over");
      gameDiv.style.display = "none";
      menu.style.display = "block";
    }
  });

  obstacles = obstacles.filter(o=>o.x > -60);
  if (frame % 80 === 0) spawnObstacle();

  score++;
  frame++;
  requestAnimationFrame(loop);
}
</script>

</body>
</html>
