<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Runner Game</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #222;
}

#menu, #warning, #game {
  width: 100vw;
  height: 100vh;
  display: none;
  position: relative;
}

#menu {
  display: block;
  background: linear-gradient(#cceeff, #ffffff);
}

button {
  font-size: 28px;
  padding: 15px 40px;
  border-radius: 20px;
  border: none;
  cursor: pointer;
}

#playBtn {
  position: absolute;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  background: #4caf50;
  color: white;
}

#saveBtn {
  position: absolute;
  top: 20px;
  right: 20px;
  background: gold;
}

#money {
  position: absolute;
  top: 20px;
  left: 20px;
  font-size: 24px;
  background: white;
  padding: 10px 20px;
  border-radius: 15px;
}

#warning {
  background: rgba(0,0,0,0.8);
  color: white;
  text-align: center;
  padding-top: 40vh;
}

#game {
  background: #ddd;
}

canvas {
  background: #eee;
  display: block;
  margin: auto;
}
</style>
</head>

<body>

<div id="menu">
  <div id="money">üí∞ <span id="coinText">0</span></div>
  <button id="saveBtn">SAVE</button>
  <button id="playBtn">PLAY</button>
</div>

<div id="warning">
  <h2>‚ö†Ô∏è C·∫¢NH B√ÅO</h2>
  <p>Ch∆°i xong nh·ªõ l∆∞u game,<br>n·∫øu kh√¥ng s·∫Ω m·∫•t ti·∫øn tr√¨nh ch∆°i</p>
  <button onclick="startGame()">OK</button>
</div>

<div id="game">
  <canvas id="cv" width="900" height="450"></canvas>
</div>

<script>
const menu = document.getElementById("menu");
const warning = document.getElementById("warning");
const gameDiv = document.getElementById("game");
const canvas = document.getElementById("cv");
const ctx = canvas.getContext("2d");

let coins = Number(localStorage.getItem("coins")) || 0;
document.getElementById("coinText").innerText = coins;

document.getElementById("saveBtn").onclick = () => {
  localStorage.setItem("coins", coins);
  alert("ƒê√£ l∆∞u ti·ªÅn!");
};

document.getElementById("playBtn").onclick = () => {
  menu.style.display = "none";
  warning.style.display = "block";
};

function startGame() {
  warning.style.display = "none";
  gameDiv.style.display = "block";
  resetGame();
  loop();
}

/* GAME */
const lanes = [100, 225, 350];
let playerLane = 1;
let legAngle = 0;

let obstacles = [];
let speed = 5;
let score = 0;
let running = true;

function resetGame() {
  obstacles = [];
  playerLane = 1;
  score = 0;
  running = true;
}

document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp" && playerLane > 0) playerLane--;
  if (e.key === "ArrowDown" && playerLane < 2) playerLane++;
});

function spawnObstacle() {
  const type = Math.floor(Math.random() * 3);
  obstacles.push({
    x: canvas.width,
    lane: Math.floor(Math.random() * 3),
    type
  });
}

function drawPlayer() {
  const x = 150;
  const y = lanes[playerLane];

  // ƒë·∫ßu
  ctx.beginPath();
  ctx.arc(x, y - 40, 12, 0, Math.PI * 2);
  ctx.stroke();

  // th√¢n
  ctx.beginPath();
  ctx.moveTo(x, y - 28);
  ctx.lineTo(x, y + 20);
  ctx.stroke();

  // tay
  ctx.beginPath();
  ctx.moveTo(x - 15, y);
  ctx.lineTo(x + 15, y);
  ctx.stroke();

  // ch√¢n (ch·∫°y)
  legAngle += 0.2;
  ctx.beginPath();
  ctx.moveTo(x, y + 20);
  ctx.lineTo(x - 10, y + 40 + Math.sin(legAngle) * 10);
  ctx.moveTo(x, y + 20);
  ctx.lineTo(x + 10, y + 40 - Math.sin(legAngle) * 10);
  ctx.stroke();
}

function drawObstacle(o) {
  const y = lanes[o.lane];

  if (o.type === 0) { // ƒë√°
    ctx.fillStyle = "gray";
    ctx.fillRect(o.x, y - 20, 40, 30);
  }

  if (o.type === 1) { // c√¢y
    ctx.fillStyle = "brown";
    ctx.fillRect(o.x + 10, y - 20, 20, 40);
    ctx.fillStyle = "green";
    ctx.beginPath();
    ctx.arc(o.x + 20, y - 30, 25, 0, Math.PI * 2);
    ctx.fill();
  }

  if (o.type === 2) { // h·ªë (v·∫≠t c·∫£n m·ªõi)
    ctx.fillStyle = "black";
    ctx.fillRect(o.x, y + 20, 50, 10);
  }
}

function checkCollision(o) {
  return o.x < 180 && o.x > 120 && o.lane === playerLane;
}

let frame = 0;
function loop() {
  if (!running) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  // v·∫Ω l√†n
  ctx.strokeStyle = "#999";
  lanes.forEach(y=>{
    ctx.beginPath();
    ctx.moveTo(0,y);
    ctx.lineTo(canvas.width,y);
    ctx.stroke();
  });

  drawPlayer();

  obstacles.forEach(o=>{
    o.x -= speed;
    drawObstacle(o);
    if (checkCollision(o)) {
      running = false;
      coins += Math.floor(score / 10);
      alert("Game Over!");
      gameDiv.style.display = "none";
      menu.style.display = "block";
    }
  });

  obstacles = obstacles.filter(o=>o.x > -60);

  if (frame % 90 === 0) spawnObstacle();

  score++;
  frame++;
  requestAnimationFrame(loop);
}
</script>

</body>
</html>
